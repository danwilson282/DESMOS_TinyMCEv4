tinymce.PluginManager.add('desmos', function(editor, url) {

        
  editor.addButton('desmos', {
    image: url+'/img/desmos.png',
    tooltip: "Insert from DESMOS",

    onclick: function() {
      createGraph();
    }
  });

  // Adds a menu item to the tools menu
  editor.addMenuItem('desmos', {
    text: 'Insert DESMOS Graph or Equation',
    image: url+'/img/desmos.png',
    context: 'insert',
    onclick: function() {
      createGraph();
    }
  });

  return {
    getMetadata: function () {
      return  {
        name: "Example plugin",
        url: "http://exampleplugindocsurl.com"
      };
    }
  };
  
function createGraph(){
         editor.windowManager.open({
        title: 'Insert DESMOS graph or equation',
        type: "container",
        html:"<div id='calc' style='width: 600px; height: 400px; margin: 0 auto;'></div><div>Additional Settings:<br><br></div><div>Width: <input type='range' min='100' max='800' value='600' class='slider' id='width'></div><div>Height: <input type='range' min='100' max='500' value='400' class='slider' id='height'></div>",
        width: 800,
        height: 600,
        buttons: [{
          text: 'Close',
          onclick: 'close'
        },
        {
          text: 'Insert Equation(s)',
          onclick: function(){
              var calcData = calc.getExpressions();
              //console.log(calcData);
              var equation = new Array;
              var i=1;
              calcData.forEach(function(entry){
                  equation[i] = entry.latex;
                  if(equation[i]!=0){
                  editor.insertContent("<img src=\"https://math.now.sh?from="+equation[i]+"\">");
              }
                  i++;
              });
              editor.windowManager.close();

          }
        },
        {text: 'Insert Graph',
        onclick: function(){
            //Create temporary image Div and create the screenshot
            TempImage = document.createElement("img");
            TempImage.id = "image";
            TempImage.src = calc.screenshot();
            //Add to window and close
            editor.insertContent("<img src=\""+TempImage.src+"\">");
            editor.windowManager.close();
        }}
        ]
    
      });
        //Create Calculator
        var calcElt2 = document.getElementById('calc');
        var calc = Desmos.GraphingCalculator(calcElt2);
        //Set Width slider event listener
        width = document.getElementById("width");
        width.addEventListener("input", function(){
              document.getElementById("calc").style.width=width.value;
              });
        //Set height event listener
        height = document.getElementById("height");
        height.addEventListener("input", function(){
              document.getElementById("calc").style.height=height.value;
              });
}



});

